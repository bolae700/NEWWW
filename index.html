<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MICRO RETRO PLAYER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2a 100%);
            color: #e0e0ff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Share Tech Mono', monospace;
            padding: 10px;
            overflow: hidden;
            position: relative;
        }

        /* Enhanced Background with More Visibility */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://xatimg.com/image/MIgzs1WSn1yd.png');
            background-size: cover;
            background-position: center;
            opacity: 0.25;
            z-index: -2;
        }

        /* Simplified Glitch Effect */
        .glitch-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0.4;
        }

        .glitch-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2a 100%);
            mix-blend-mode: overlay;
        }

        .glitch-layer:nth-child(1) {
            animation: glitch-1 10s infinite linear alternate-reverse;
        }

        .glitch-layer:nth-child(2) {
            animation: glitch-2 15s infinite linear alternate-reverse;
        }

        @keyframes glitch-1 {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        @keyframes glitch-2 {
            0% { transform: translate(0); }
            25% { transform: translate(1px, -1px); }
            50% { transform: translate(-1px, 1px); }
            75% { transform: translate(1px, 1px); }
            100% { transform: translate(0); }
        }

        /* Scanlines Effect */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(100, 150, 255, 0.03) 50%, 
                transparent 50%);
            background-size: 100% 3px;
            z-index: 1;
            pointer-events: none;
            opacity: 0.3;
        }

        /* Micro Player Container */
        .player-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            position: relative;
            z-index: 2;
        }

        /* Micro Player - 16:9 Aspect Ratio */
        .player {
            width: 320px; /* 16:9 ratio for 320x180 */
            height: 180px;
            background: rgba(10, 10, 20, 0.9);
            border: 1px solid #4a6bff;
            box-shadow: 
                0 0 8px rgba(74, 107, 255, 0.4),
                0 0 15px rgba(74, 107, 255, 0.2),
                inset 0 0 10px rgba(74, 107, 255, 0.1);
            padding: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(3px);
            border-radius: 8px;
        }

        .player::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 49%, rgba(74, 107, 255, 0.03) 50%, transparent 51%);
            background-size: 4px 4px;
            pointer-events: none;
            z-index: 1;
        }

        .lyrics-panel {
            width: 320px;
            height: 180px;
            background: rgba(10, 10, 20, 0.9);
            border: 1px solid #4a6bff;
            box-shadow: 
                0 0 8px rgba(74, 107, 255, 0.4),
                0 0 15px rgba(74, 107, 255, 0.2),
                inset 0 0 10px rgba(74, 107, 255, 0.1);
            padding: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(3px);
            border-radius: 8px;
            display: none;
        }

        .lyrics-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 49%, rgba(74, 107, 255, 0.03) 50%, transparent 51%);
            background-size: 4px 4px;
            pointer-events: none;
            z-index: 1;
        }

        /* Compact Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            border-bottom: 1px solid #4a6bff;
            padding-bottom: 8px;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #4a6bff;
            margin-bottom: 2px;
        }

        .subtitle {
            font-size: 8px;
            color: #8a9bff;
            letter-spacing: 1px;
            font-weight: 300;
        }

        .datetime {
            text-align: left;
        }

        .time {
            font-family: 'Orbitron', monospace;
            font-size: 10px;
            font-weight: 700;
            color: #4a6bff;
            margin-bottom: 1px;
        }

        .date {
            font-size: 8px;
            color: #8a9bff;
            font-weight: 300;
        }

        /* Profile Section - Compact */
        .profile-section {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            gap: 8px;
        }

        .profile-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #4a6bff;
            box-shadow: 0 0 5px rgba(74, 107, 255, 0.4);
            overflow: hidden;
            position: relative;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 11px;
            font-weight: 700;
            color: #4a6bff;
            margin-bottom: 2px;
        }

        .profile-status {
            font-size: 8px;
            color: #8a9bff;
            letter-spacing: 0.5px;
        }

        /* Minimal Visualizer */
        .visualizer-container {
            position: relative;
            width: 100%;
            height: 40px;
            margin-bottom: 10px;
            background: rgba(15, 15, 30, 0.5);
            border: 1px solid #4a6bff;
            border-radius: 4px;
            overflow: hidden;
        }

        #waveCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .track-info {
            text-align: center;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }

        .track-title {
            font-size: 11px;
            font-weight: 700;
            color: #4a6bff;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            letter-spacing: 0.5px;
        }

        .track-artist {
            font-size: 9px;
            color: #8a9bff;
            letter-spacing: 0.5px;
            font-weight: 300;
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(20, 20, 40, 0.5);
            overflow: hidden;
            border: 1px solid #4a6bff;
            border-radius: 2px;
            position: relative;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4a6bff, #6a8bff);
            width: 0%;
            transition: width 0.1s;
            border-radius: 1px;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: #8a9bff;
            margin-top: 4px;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        /* Compact Controls */
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
            gap: 6px;
        }

        .control-btn {
            padding: 5px 8px;
            background: rgba(15, 15, 30, 0.7);
            border: 1px solid #4a6bff;
            color: #4a6bff;
            cursor: pointer;
            font-size: 10px;
            font-weight: 400;
            transition: all 0.2s;
            letter-spacing: 0.5px;
            font-family: 'Share Tech Mono', monospace;
            position: relative;
            overflow: hidden;
            flex: 1;
            text-align: center;
            border-radius: 3px;
        }

        .control-btn:active {
            background: rgba(74, 107, 255, 0.2);
            transform: scale(0.95);
        }

        .control-btn:hover {
            background: rgba(74, 107, 255, 0.1);
        }

        .play-pause {
            flex: 2;
            font-weight: 700;
            background: rgba(74, 107, 255, 0.1);
            font-size: 11px;
        }

        /* Micro Playlist */
        .playlist {
            max-height: 60px;
            overflow-y: auto;
            border: 1px solid #4a6bff;
            padding: 6px;
            background: rgba(15, 15, 30, 0.5);
            position: relative;
            z-index: 2;
            border-radius: 3px;
        }

        .track-item {
            padding: 4px 6px;
            border-bottom: 1px solid rgba(74, 107, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
            font-size: 9px;
            border-radius: 2px;
        }

        .track-item:hover {
            background: rgba(74, 107, 255, 0.1);
        }

        .track-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .track-number {
            width: 16px;
            height: 16px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 700;
            color: #4a6bff;
            border: 1px solid #4a6bff;
            font-family: 'Orbitron', monospace;
            border-radius: 50%;
        }

        .track-name {
            flex: 1;
            color: #8a9bff;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .track-duration {
            font-size: 8px;
            color: #4a6bff;
            font-weight: 300;
            font-family: 'Orbitron', monospace;
        }

        .active-track {
            background: rgba(74, 107, 255, 0.15);
            border: 1px solid #4a6bff;
        }

        .active-track .track-number {
            background: #4a6bff;
            color: #0a0a1a;
        }

        .active-track .track-name {
            color: #4a6bff;
            font-weight: 700;
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 15, 30, 0.5);
            border-radius: 1px;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a6bff;
            border-radius: 1px;
        }

        .footer {
            text-align: center;
            font-size: 8px;
            color: #8a9bff;
            margin-top: 8px;
            position: relative;
            letter-spacing: 0.5px;
            font-weight: 300;
            border-top: 1px solid #4a6bff;
            padding-top: 6px;
            z-index: 2;
        }

        /* Lyrics Panel Styles */
        .lyrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            border-bottom: 1px solid #4a6bff;
            padding-bottom: 8px;
        }

        .lyrics-title {
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #4a6bff;
        }

        .close-lyrics {
            background: rgba(15, 15, 30, 0.7);
            border: 1px solid #4a6bff;
            color: #4a6bff;
            font-size: 10px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 50%;
        }

        .close-lyrics:hover {
            background: rgba(74, 107, 255, 0.1);
        }

        .lyrics-content {
            height: 120px;
            overflow-y: auto;
            padding: 6px;
            font-size: 9px;
            line-height: 1.5;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .lyrics-line {
            margin-bottom: 8px;
            color: #8a9bff;
            transition: all 0.3s;
            padding: 4px;
            border-radius: 2px;
        }

        .lyrics-line.active {
            color: #4a6bff;
            font-weight: 700;
            background: rgba(74, 107, 255, 0.1);
        }

        .show-lyrics-btn {
            width: 100%;
            padding: 6px;
            background: rgba(15, 15, 30, 0.7);
            border: 1px solid #4a6bff;
            color: #4a6bff;
            cursor: pointer;
            font-size: 9px;
            font-weight: 400;
            transition: all 0.2s;
            letter-spacing: 0.5px;
            font-family: 'Share Tech Mono', monospace;
            margin-top: 8px;
            border-radius: 3px;
        }

        .show-lyrics-btn:hover {
            background: rgba(74, 107, 255, 0.1);
        }

        /* VHS Effect - Subtle */
        .vhs-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.03;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(100, 150, 255, 0.1) 2px,
                rgba(100, 150, 255, 0.1) 4px
            );
            animation: vhs-scroll 30s linear infinite;
        }

        @keyframes vhs-scroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }
    </style>
</head>
<body>
    <!-- Glitch Effect -->
    <div class="glitch-container">
        <div class="glitch-layer"></div>
        <div class="glitch-layer"></div>
    </div>
    
    <!-- Scanlines Effect -->
    <div class="scanlines"></div>
    
    <!-- VHS Effect -->
    <div class="vhs-effect"></div>

    <div class="player-container">
        <div class="player">
            <div class="header">
                <div class="logo-section">
                    <div class="logo">MICRO RETRO</div>
                    <div class="subtitle">MUSIC PLAYER</div>
                </div>
                <div class="datetime">
                    <div class="time" id="currentTime">00:00:00</div>
                    <div class="date" id="currentDate">Loading...</div>
                </div>
            </div>

            <div class="profile-section">
                <div class="profile-image">
                    <img src="https://xatimg.com/image/MhdPKr3UzfLM.png" alt="Profile">
                </div>
                <div class="profile-info">
                    <div class="profile-name">CYAN BEATS</div>
                    <div class="profile-status">ONLINE | RETRO MODE</div>
                </div>
            </div>

            <div class="visualizer-container">
                <canvas id="waveCanvas"></canvas>
            </div>

            <div class="track-info">
                <div class="track-title" id="trackTitle">SELECT TRACK</div>
                <div class="track-artist" id="trackArtist">CLICK ON PLAYLIST</div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTrackTime">0:00</span>
                    <span id="trackDuration">0:00</span>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" id="prevBtn">⏮</button>
                <button class="control-btn play-pause" id="playPauseBtn">▶</button>
                <button class="control-btn" id="nextBtn">⏭</button>
            </div>

            <div class="playlist" id="playlist">
                <!-- Tracks will be added here by JavaScript -->
            </div>

            <button class="show-lyrics-btn" id="showLyricsBtn">LYRICS</button>

            <div class="footer">
                SYSTEM ONLINE | MICRO MODE | V2.0
            </div>
        </div>

        <div class="lyrics-panel" id="lyricsPanel">
            <div class="lyrics-header">
                <div class="lyrics-title">LYRICS</div>
                <button class="close-lyrics" id="closeLyricsBtn">X</button>
            </div>
            <div class="lyrics-content" id="lyricsContent">
                <!-- Lyrics will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Date and Time
        function updateDateTime() {
            const now = new Date();
            
            // Format time
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Format date
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
        }

        // Update date/time every second
        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Music tracks with direct URLs and lyrics
        const tracks = [
            { 
                id: 1, 
                name: "Asphalt Heartbeat", 
                url: "https://audio.jukehost.co.uk/g1mnUVIICxoL3IQgWT1D1eBE3PebQz2z", 
                duration: "5:12",
                lyrics: [
                    "Lights on. GO.",
                    "",
                    "Red line flash",
                    "Concrete dash",
                    "No time waste",
                    "Join the chase",
                    "City bright",
                    "Endless night",
                    "Feel the pace",
                    "In this race.",
                    "",
                    "The beat gets louder, feel the ground shake",
                    "Push it faster, for goodness sake!",
                    "",
                    "Asphalt heartbeat, syncs with mine",
                    "Crossing every single line!",
                    "Engine screams the name of night:",
                    "يا ليل! (Ya Layl!)",
                    "Burning through the neon light:",
                    "يا ليل! (Ya Layl!)",
                    "",
                    "Steel frame shakes",
                    "No mistakes",
                    "Pulse is high",
                    "Watch me fly",
                    "Ghosts behind",
                    "Lose my mind",
                    "Can't rewind",
                    "Leave them blind.",
                    "",
                    "The beat gets louder, feel the ground shake",
                    "Push it faster, for goodness sake!",
                    "",
                    "Asphalt heartbeat, syncs with mine",
                    "Crossing every single line!",
                    "Engine screams the name of night:",
                    "يا ليل! (Ya Layl!)",
                    "Burning through the neon light:",
                    "يا ليل! (Ya Layl!)",
                    "",
                    "Just the sound...",
                    "Spinning 'round...",
                    "Lost and found...",
                    "",
                    "Asphalt heartbeat, syncs with mine",
                    "Crossing every single line!",
                    "Engine screams the name of night:",
                    "يا ليل! (Ya Layl!)",
                    "Burning through the neon light:",
                    "يا ليل! (Ya Layl!)"
                ]
            },
            { 
                id: 2, 
                name: "Gönül Yarası", 
                url: "https://audio.jukehost.co.uk/w6ljByylsvFth6LBE48dCCqdd0Ki9mUH", 
                duration: "8:28",
                lyrics: [
                    "Güzelim, çıktı başımdan duman",
                    "Bu aşkın elemi bitsin artık yaman",
                    "",
                    "Yaktın beni aman, o bakışınla yar",
                    "Bu hasretlik ömre bedel, gel olmasın ayrılık",
                    "Sensiz geçmiyor hiç bir an, canan",
                    "Bu hasretlik ömre bedel, gel olmasın ayrılık",
                    "",
                    "Her gece sensizlik oldu bana dert",
                    "Gel hadi çare ol, bitsin bu kara sert",
                    "",
                    "Yaktın beni aman, o bakışınla yar",
                    "Bu hasretlik ömre bedel, gel olmasın ayrılık",
                    "Sensiz geçmiyor hiç bir an, canan",
                    "Bu hasretlik ömre bedel, gel olmasın ayrılık",
                    "",
                    "Gel olmasın ayrılık...",
                    "Canan..."
                ]
            },
            { 
                id: 3, 
                name: "Good Bye Yesterday", 
                url: "https://audio.jukehost.co.uk/aRDwAN2KfAQ3rC2SqPdxEbF3eCtsz6A5", 
                duration: "2:49",
                lyrics: [
                    "Goodbye, yesterday's tears and pain,",
                    "Washed clean by morning's gentle rain.",
                    "Thank You, God, for this brand new start,",
                    "Hope rising fresh within my heart.",
                    "Sunlight chases shadows long,",
                    "To Your mercy we belong.",
                    "",
                    "Oh, Today! Your freedom's sweet!",
                    "Lift our souls with dancing feet!",
                    "With every breath, Your love we feel,",
                    "Grace is true, and mercy's real!",
                    "Let the bağlama ring, the modern beat ignite,",
                    "We dance in Your forgiving light!",
                    "",
                    "Golden Horn shines, troubles fade away,",
                    "Thanking God for this blessed day.",
                    "This rhythm divine, a joyful sound,",
                    "In Your loving arms we're found."
                ]
            }
        ];

        // Global variables
        let audioContext;
        let analyser;
        let source;
        let audioElement;
        let isPlaying = false;
        let currentTrackIndex = 0;
        let animationId;

        // Initialize the player
        function initPlayer() {
            // Create audio element
            audioElement = new Audio();
            audioElement.crossOrigin = "anonymous";
            
            // Set initial volume to 100%
            audioElement.volume = 1.0;
            
            // Initialize playlist
            renderPlaylist();
            
            // Set up lyrics panel
            document.getElementById('showLyricsBtn').addEventListener('click', showLyricsPanel);
            document.getElementById('closeLyricsBtn').addEventListener('click', hideLyricsPanel);
            
            // Initialize visualizer after user interaction
            document.getElementById('playPauseBtn').addEventListener('click', initAudioContext);
        }

        // Initialize audio context after user interaction
        function initAudioContext() {
            if (audioContext) return;
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 128;
                
                source = audioContext.createMediaElementSource(audioElement);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                initVisualizer();
            } catch (e) {
                console.error("Web Audio API not supported", e);
            }
        }

        // Render the playlist
        function renderPlaylist() {
            const playlist = document.getElementById('playlist');
            playlist.innerHTML = '';
            
            tracks.forEach((track, index) => {
                const trackItem = document.createElement('div');
                trackItem.className = 'track-item';
                if (index === currentTrackIndex) {
                    trackItem.classList.add('active-track');
                }
                
                trackItem.innerHTML = `
                    <div class="track-number">${track.id}</div>
                    <div class="track-name">${track.name}</div>
                    <div class="track-duration">${track.duration}</div>
                `;
                
                trackItem.addEventListener('click', () => {
                    playTrack(index);
                });
                
                playlist.appendChild(trackItem);
            });
        }

        // Show lyrics panel
        function showLyricsPanel() {
            document.getElementById('lyricsPanel').style.display = 'block';
            updateLyrics();
        }

        // Hide lyrics panel
        function hideLyricsPanel() {
            document.getElementById('lyricsPanel').style.display = 'none';
        }

        // Update lyrics display
        function updateLyrics() {
            const lyricsContent = document.getElementById('lyricsContent');
            const currentTrack = tracks[currentTrackIndex];
            
            if (!currentTrack.lyrics) {
                lyricsContent.innerHTML = '<div class="lyrics-line">No lyrics available for this track</div>';
                return;
            }
            
            // Clear previous lyrics
            lyricsContent.innerHTML = '';
            
            // Add all lyrics lines
            currentTrack.lyrics.forEach((line, index) => {
                const lyricLine = document.createElement('div');
                lyricLine.className = 'lyrics-line';
                lyricLine.textContent = line;
                lyricsContent.appendChild(lyricLine);
            });
        }

        // Play a specific track
        function playTrack(index) {
            currentTrackIndex = index;
            
            // Stop current playback
            if (isPlaying) {
                audioElement.pause();
                isPlaying = false;
            }
            
            // Load new track
            audioElement.src = tracks[index].url;
            document.getElementById('trackTitle').textContent = tracks[index].name;
            document.getElementById('trackArtist').textContent = `TRACK ${tracks[index].id}`;
            
            // Reset progress
            document.getElementById('progress').style.width = '0%';
            document.getElementById('currentTrackTime').textContent = '0:00';
            document.getElementById('trackDuration').textContent = tracks[index].duration;
            
            // Update active track in playlist
            renderPlaylist();
            
            // Update lyrics if panel is open
            if (document.getElementById('lyricsPanel').style.display === 'block') {
                updateLyrics();
            }
            
            // Play the track
            togglePlayPause();
        }

        // Update track info when metadata is loaded
        function updateTrackInfo() {
            document.getElementById('trackDuration').textContent = formatTime(audioElement.duration);
        }

        // Update progress bar and time display
        function updateProgress() {
            const progress = document.getElementById('progress');
            const currentTrackTime = document.getElementById('currentTrackTime');
            
            if (audioElement.duration) {
                const percent = (audioElement.currentTime / audioElement.duration) * 100;
                progress.style.width = percent + '%';
                currentTrackTime.textContent = formatTime(audioElement.currentTime);
            }
        }

        // Format time in MM:SS
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Handle track end
        function handleTrackEnd() {
            playNextTrack();
        }

        // Play next track
        function playNextTrack() {
            currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
            playTrack(currentTrackIndex);
        }

        // Play previous track
        function playPrevTrack() {
            currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
            playTrack(currentTrackIndex);
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (!audioElement.src) {
                // If no track is loaded, load the first one
                playTrack(0);
                return;
            }
            
            if (isPlaying) {
                audioElement.pause();
                document.getElementById('playPauseBtn').textContent = '▶';
                isPlaying = false;
            } else {
                // Initialize audio context if not already done
                if (!audioContext) {
                    initAudioContext();
                }
                
                // Resume audio context if suspended
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                audioElement.play().then(() => {
                    document.getElementById('playPauseBtn').textContent = '⏸';
                    isPlaying = true;
                }).catch(e => {
                    console.error("Play failed:", e);
                    alert("Cannot play audio. Please check the browser console for details.");
                });
            }
        }

        // Initialize visualizer
        function initVisualizer() {
            const canvas = document.getElementById('waveCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // Start animation loop
            animateVisualizer();
        }

        // Start visualizer animation
        function startVisualizer() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            animateVisualizer();
        }

        // Minimal Visualizer - Simple Waveform
        function animateVisualizer() {
            const canvas = document.getElementById('waveCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = 'rgba(15, 15, 30, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (isPlaying && analyser) {
                // Get frequency data
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                // Draw minimal waveform
                const centerY = canvas.height / 2;
                const sliceWidth = canvas.width / bufferLength;
                
                // Primary wave
                ctx.strokeStyle = '#4a6bff';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                
                let x = 0;
                for (let i = 0; i < bufferLength; i++) {
                    const v = dataArray[i] / 128.0;
                    const y = centerY + (v * centerY / 3);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    x += sliceWidth;
                }
                ctx.stroke();
                
                // Draw frequency bars (minimal)
                const barWidth = (canvas.width / bufferLength) * 2;
                let barX = 0;
                
                for (let i = 0; i < bufferLength; i+=3) {
                    const barHeight = dataArray[i] / 4;
                    
                    ctx.fillStyle = '#4a6bff';
                    ctx.fillRect(barX, canvas.height - barHeight, barWidth, barHeight);
                    
                    barX += barWidth + 1;
                }
            }
            
            animationId = requestAnimationFrame(animateVisualizer);
        }

        // Set up event listeners
        document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
        document.getElementById('prevBtn').addEventListener('click', playPrevTrack);
        document.getElementById('nextBtn').addEventListener('click', playNextTrack);

        // Set up audio element event listeners
        function setupAudioEvents() {
            audioElement.addEventListener('loadedmetadata', updateTrackInfo);
            audioElement.addEventListener('timeupdate', updateProgress);
            audioElement.addEventListener('ended', handleTrackEnd);
        }

        // Initialize on load
        window.addEventListener('load', function() {
            initPlayer();
            setupAudioEvents();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('waveCanvas');
            if (canvas) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
        });
    </script>
</body>
</html>
